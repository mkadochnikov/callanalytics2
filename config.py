#!/usr/bin/env python3
"""
Конфигурация и импорты для системы анализа звонков Bitrix24
"""

import os
import json
import hashlib
import requests
import datetime
import pytz
from pathlib import Path
from typing import List, Dict, Optional, Tuple
import logging
from bs4 import BeautifulSoup
import streamlit as st
import pandas as pd
import plotly.express as px
import whisper
import torch
from transformers import pipeline
import re

# Настройка логирования
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
logger = logging.getLogger(__name__)

# Конфигурация
PORTAL_TIMEZONE = 'Europe/Moscow'
WHISPER_MODEL_SIZE = "medium"

# Расширенные темы звонков с ключевыми словами
CALL_TOPICS = {
    "Продажи": ["продажи", "предложение", "коммерческий", "покупка", "заказ", "прайс", "цена", "стоимость", "купить", "приобрести", "товар", "услуга", "скидка", "акция"],
    "Техподдержка": ["проблема", "ошибка", "не работает", "сломался", "поломка", "техническая", "поддержка", "помощь", "настройка", "установка", "баг", "глюк"],
    "Консультация": ["вопрос", "как", "можно ли", "расскажите", "объясните", "консультация", "информация", "уточнить", "узнать", "подскажите"],
    "Жалоба": ["жалоба", "недоволен", "плохо", "ужасно", "возврат", "претензия", "некачественно", "обман", "мошенники", "верните деньги"],
    "Партнерство": ["партнерство", "сотрудничество", "совместный", "партнер", "коллаборация", "взаимовыгодный", "предложение о сотрудничестве"],
    "Холодные продажи": ["холодный", "знакомство", "представляю компанию", "слышали о нас", "предлагаем", "заинтересованы ли"],
    "Повторное обращение": ["звонил ранее", "обещали", "договорились", "следующий этап", "продолжение", "как дела с"]
}

# Расширенные причины отказов с ключевыми фразами
REJECTION_PATTERNS = {
    "Высокая цена": ["дорого", "цена высокая", "много денег", "не по карману", "дешевле", "слишком дорого", "цена не подходит", "бюджет меньше"],
    "Нет времени": ["времени нет", "некогда", "занят", "позже позвоню", "не сейчас", "в другой раз", "нет времени разговаривать"],
    "Есть поставщик": ["уже работаем с", "есть поставщик", "другая компания", "уже заключен договор", "постоянный поставщик"],
    "Не нужна услуга": ["не нужно", "не интересует", "не актуально", "не требуется", "нет необходимости", "не подходит"],
    "Нужно подумать": ["подумать", "посоветоваться", "обсудить", "принять решение", "рассмотрим", "изучим предложение"],
    "Нет бюджета": ["нет денег", "нет бюджета", "нет средств", "финансовые трудности", "кризис", "экономим"],
    "Плохие условия": ["условия не подходят", "не устраивают условия", "другие требования", "не согласны с условиями"],
    "Недоверие": ["не доверяю", "мошенники", "обман", "развод на деньги", "сомневаюсь", "не верю"],
    "Конкуренты лучше": ["у конкурентов", "другие предлагают", "лучше условия", "дешевле у других"]
}